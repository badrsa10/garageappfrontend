<p-toast></p-toast>

<div class="card">
  <div class="flex justify-between items-center mb-4">
    <div class="font-semibold text-xl">Fournisseur Management</div>
    <div class="flex gap-2">
      <button pButton label="Add Fournisseur" class="p-button-success" (click)="openAddDialog()"></button>
    </div>
  </div>

  <p-table
    #dtF
    [value]="fournisseurs"
    dataKey="id_fournisseur"
    [(selection)]="selectedFournisseurs"
    [rows]="pageSize"
    [loading]="loading"
    [rowHover]="true"
    [showGridlines]="true"
    [paginator]="true"
    [totalRecords]="totalFournisseurs"
    [lazy]="true"
    (onLazyLoad)="onPageChange($event)"
    responsiveLayout="scroll"
  >
    <ng-template pTemplate="caption">
      <div class="flex justify-between items-center flex-column sm:flex-row">
        <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(dtF)"></button>
        <button
          pButton
          label="Delete"
          class="p-button-danger p-button-outlined mb-2 mx-4"
          (click)="deleteSelectedFournisseurs()"
          [disabled]="!selectedFournisseurs.length"
        ></button>
        <p-iconfield iconPosition="left" class="ml-auto">
          <p-inputicon>
            <i class="pi pi-search"></i>
          </p-inputicon>
          <input pInputText type="text" (input)="onGlobalFilter(dtF, $event)" placeholder="Search fournisseurs" />
        </p-iconfield>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th style="width: 3rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-fournisseur>
      <tr (click)="navigateToProfile(fournisseur.id_fournisseur)">
        <td (click)="$event.stopPropagation()">
          <p-tableCheckbox [value]="fournisseur"></p-tableCheckbox>
        </td>
        <td>{{ fournisseur.nom }} {{ fournisseur.prenom }}</td>
        <td>{{ fournisseur.email }}</td>
        <td>{{ fournisseur.tel }}</td>
        <td class="flex gap-2">
          <button
            pButton
            icon="pi pi-pencil"
            class="p-button-text p-button-sm"
            (click)="updateFournisseur(fournisseur)"
            (click)="$event.stopPropagation()"
          ></button>
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-text p-button-sm"
            (click)="deleteFournisseur(fournisseur.id_fournisseur)"
            (click)="$event.stopPropagation()"
          ></button>
          <button
            pButton
            icon="pi pi-user"
            class="p-button-text p-button-sm"
            (click)="navigateToProfile(fournisseur.id_fournisseur)"
            (click)="$event.stopPropagation()"
          ></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">No fournisseurs found.</td>
      </tr>
    </ng-template>

    <ng-template pTemplate="loadingbody">
      <tr>
        <td colspan="5">Loading fournisseur data. Please wait.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- âœ… Add Fournisseur Dialog -->
<p-dialog
  header="Add Fournisseur"
  [(visible)]="displayDialog"
  [modal]="true"
  [style]="{ width: '35vw' }"
  [breakpoints]="{ '960px': '90vw' }"
>
  <div class="p-fluid p-4 space-y-4">
    <div class="p-field p-grid">
      <label for="nom" class="p-col-12 p-md-4 font-medium">Name</label>
      <div class="p-col-12 p-md-8">
        <input id="nom" type="text" pInputText [(ngModel)]="newFournisseur.nom" class="w-full" />
      </div>
    </div>

    <div class="p-field p-grid">
      <label for="prenom" class="p-col-12 p-md-4 font-medium">First Name</label>
      <div class="p-col-12 p-md-8">
        <input id="prenom" type="text" pInputText [(ngModel)]="newFournisseur.prenom" class="w-full" />
      </div>
    </div>

    <div class="p-field p-grid">
      <label for="email" class="p-col-12 p-md-4 font-medium">Email</label>
      <div class="p-col-12 p-md-8">
        <input id="email" type="email" pInputText [(ngModel)]="newFournisseur.email" class="w-full" />
      </div>
    </div>

    <div class="p-field p-grid">
      <label for="tel" class="p-col-12 p-md-4 font-medium">Phone</label>
      <div class="p-col-12 p-md-8">
        <input id="tel" type="text" pInputText [(ngModel)]="newFournisseur.tel" class="w-full" />
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-3 px-4 pb-4">
      <button pButton label="Cancel" class="p-button-outlined" (click)="displayDialog = false"></button>
      <button pButton label="Save" class="p-button-primary" (click)="addFournisseur()"></button>
    </div>
  </ng-template>
</p-dialog>
