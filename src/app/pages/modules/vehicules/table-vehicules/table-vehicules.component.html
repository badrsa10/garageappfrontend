<div class="card">
  <div class="flex justify-between items-center mb-4">
    <div class="font-semibold text-xl">Vehicule Management</div>
    <button pButton label="Add Vehicule" class="p-button-success" (click)="displayDialog = true"></button>
  </div>

  <p-table #dt1 
           [value]="vehicules" 
           dataKey="id_vehicule" 
           [rows]="10" 
           [loading]="loading" 
           [rowHover]="true"
           [showGridlines]="true" 
           [paginator]="true"
           [globalFilterFields]="['matricule', 'marque', 'modele', 'kilometrage']" 
           responsiveLayout="scroll">

    <ng-template #caption>
      <div class="flex justify-between items-center flex-column sm:flex-row">
        <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
        <p-iconfield iconPosition="left" class="ml-auto">
          <p-inputicon>
            <i class="pi pi-search"></i>
          </p-inputicon>
          <input pInputText type="text" (input)="onGlobalFilter(dt1, $event)" placeholder="Search vehicules" />
        </p-iconfield>
      </div>
    </ng-template>

    <ng-template #header>
      <tr>
        <th style="min-width: 10rem">Matricule</th>
        <th style="min-width: 12rem">Marque</th>
        <th style="min-width: 12rem">Mod√®le</th>
        <th style="min-width: 10rem">Kilom√©trage</th>
      </tr>
    </ng-template>

    <ng-template #body let-vehicule>
      <tr class="cursor-pointer hover:bg-gray-200" (click)="navigateToVehicule(vehicule.id_vehicule)">
        <td>{{ vehicule.matricule }}</td>
        <td>{{ vehicule.marque }}</td>
        <td>{{ vehicule.modele }}</td>
        <td>{{ vehicule.kilometrage | number }} km</td>
      </tr>
    </ng-template>

    <ng-template #emptymessage>
      <tr>
        <td colspan="4">No vehicules found.</td>
      </tr>
    </ng-template>

    <ng-template #loadingbody>
      <tr>
        <td colspan="4">Loading vehicule data. Please wait.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- üîπ Pop-Up Dialog for Adding a Vehicule -->
<p-dialog header="Add Vehicule" [(visible)]="displayDialog" [modal]="true" 
          [breakpoints]="{ '960px': '75vw' }"
          [style]="{ width: '30vw' }">

  <div class="p-6 space-y-4">
    <div class="space-y-1">
      <label class="block text-gray-700 font-medium">Marque</label>
      <input type="text" pInputText [(ngModel)]="newVehicule.marque" class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300" />
    </div>

    <div class="space-y-1">
      <label class="block text-gray-700 font-medium">Mod√®le</label>
      <input type="text" pInputText [(ngModel)]="newVehicule.modele" class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300" />
    </div>

    <div class="space-y-1">
      <label class="block text-gray-700 font-medium">Ann√©e</label>
      <input type="number" pInputText [(ngModel)]="newVehicule.annee" class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300" />
    </div>

    <div class="space-y-1">
      <label class="block text-gray-700 font-medium">Kilom√©trage</label>
      <input type="number" pInputText [(ngModel)]="newVehicule.kilometrage" class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300" />
    </div>

    <div class="space-y-1">
      <label class="block text-gray-700 font-medium">Matricule</label>
      <input type="text" pInputText [(ngModel)]="newVehicule.matricule" class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300" />
    </div>

    <div class="space-y-1">
      <label class="block text-gray-700 font-medium">Num√©ro de S√©rie</label>
      <input type="text" pInputText [(ngModel)]="newVehicule.numeroSerie" class="w-full p-2 border rounded-lg focus:ring focus:ring-blue-300" />
    </div>

    <div class="space-y-1">
      <label class="block text-gray-700 font-medium">Client</label>
      <p-dropdown 
        [options]="clients" 
        optionLabel="fullName" 
        optionValue="id_client" 
        placeholder="Select Client"
        [(ngModel)]="newVehicule.clientId" 
        class="w-full"
        appendTo="body">
      </p-dropdown>
    </div>
  </div>

  <ng-template #footer>
    <div class="flex justify-end space-x-4 p-4 rounded-b-lg">
      <button pButton label="Cancel" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600"
              (click)="displayDialog = false"></button>
      <button pButton label="Save" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
              (click)="addVehicule(newVehicule)"></button>
    </div>
  </ng-template>
</p-dialog>
