<div class="card">
    <div class="flex justify-between items-center mb-4">
        <div class="font-semibold text-xl">Service Management</div>
        <div class="flex gap-2">
            <!-- Open Add Service Dialog -->
            <button pButton label="Add Service" class="p-button-success" (click)="openServiceDialog()"></button>
        </div>
    </div>

    <p-table
        #dt
        [value]="services"
        dataKey="id_service"
        [(selection)]="selectedServices"
        [rows]="pageSize"
        [loading]="loading"
        [rowHover]="true"
        [showGridlines]="true"
        [paginator]="true"
        [totalRecords]="totalServices"
        [lazy]="true"
        (onLazyLoad)="onPageChange($event)"
        responsiveLayout="scroll"
    >
        <ng-template pTemplate="caption">
            <div class="flex justify-between items-center flex-column sm:flex-row">
                <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash" (click)="clear(dt)"></button>
                <!-- Bulk Delete -->
                <button pButton label="Delete" class="p-button-outlined p-button-danger mb-2 mx-4" (click)="deleteSelected()" [disabled]="!selectedServices?.length"></button>
                <p-iconfield iconPosition="left" class="ml-auto">
                    <p-inputicon>
                        <i class="pi pi-search"></i>
                    </p-inputicon>
                    <input pInputText type="text" (input)="onGlobalFilter($event)" placeholder="Search services" />
                </p-iconfield>
            </div>
        </ng-template>

        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem">
                    <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </th>
                <th style="min-width: 12rem">Service ID</th>
                <th style="min-width: 15rem">Libelle</th>
            </tr>
        </ng-template>

        <ng-template pTemplate="body" let-service>
            <tr>
                <td>
                    <p-tableCheckbox [value]="service"></p-tableCheckbox>
                </td>
                <td>{{ service.id_service }}</td>
                <td (dblclick)="startEdit(service)">
                    <ng-container *ngIf="editingService?.id_service === service.id_service; else viewMode">
                        <input type="text" pInputText [(ngModel)]="editingService!.libelle" (blur)="saveEdit()" (keyup.enter)="saveEdit()" autofocus class="w-full" />
                    </ng-container>

                    <ng-template #viewMode>
                        {{ service.libelle }}
                    </ng-template>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="3">No services found.</td>
            </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
            <tr>
                <td colspan="3">Loading service data. Please wait.</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<!-- âœ… Add Service Dialog -->
<p-dialog header="Add Service" [(visible)]="serviceDialog" [modal]="true" [style]="{ width: '30vw' }">
    <div class="p-fluid">
        <div class="field">
            <label for="libelle" class="m-4">Service Name</label>
            <input id="libelle" class="m-4" type="text" pInputText [(ngModel)]="newService.libelle" />
        </div>
    </div>

    <ng-template pTemplate="footer">
        <button pButton label="Cancel" class="p-button-text" (click)="serviceDialog = false"></button>
        <button pButton label="Save" class="p-button-primary" (click)="addService()"></button>
    </ng-template>
</p-dialog>

<p-toast></p-toast>
